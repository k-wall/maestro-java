version: '3'
networks:
    maestro-net:
      driver: bridge
services: 
  maestro-broker:
    build: maestro-broker
    networks: 
      - maestro-net
    ports:
      - "18161:8161"
  maestro-sut:
    build: maestro-suts/apache-activemq
    networks: 
      - maestro-net
    ports:
      - "48161:8161"
# This is not needed, unless you want to test the
# broker within the container
#      - "45672:5672"
#      - "41616:61616"
  maestro-receiver:
    build:
      context: maestro-worker/maestro-receiver
      args:
        - MAESTRO_WORKER_VERSION=1.3.0-SNAPSHOT
    ports:
      - "18000:8000"
    volumes:
      - ${HOME}/tmp/maestro:/maestro
    networks: 
      - maestro-net
    depends_on:
      - maestro-broker
      - maestro-sut
  maestro-sender:
    build:
      context: maestro-worker/maestro-sender
      args:
        - MAESTRO_WORKER_VERSION=1.3.0-SNAPSHOT
    ports:
      - "28000:8000"
    volumes:
      - ${HOME}/tmp/maestro:/maestro
    networks: 
      - maestro-net
    depends_on:
      - maestro-receiver
  maestro-inspector:
      build:
        context: maestro-worker/maestro-inspector
        args:
          - MAESTRO_WORKER_VERSION=1.3.0-SNAPSHOT
      ports:
        - "38000:8000"
      volumes:
        - ${HOME}/tmp/maestro:/maestro
      networks:
        - maestro-net
      depends_on:
        - maestro-receiver
  maestro-agent:
        build:
          context: maestro-worker/maestro-agent
          args:
            - MAESTRO_WORKER_VERSION=1.3.0-SNAPSHOT
        ports:
          - "48000:8000"
        volumes:
          - ${HOME}/tmp/maestro:/maestro
        networks:
          - maestro-net
        depends_on:
          - maestro-broker
  maestro-client:
    build:
      context: maestro-client
      args:
        - MAESTRO_WORKER_VERSION=1.3.0-SNAPSHOT
    volumes:
      - ${HOME}/tmp/maestro:/maestro
    networks: 
      - maestro-net
    ports:
      - "8000:8000"
    depends_on:
      - maestro-sender
      - maestro-receiver
      - maestro-broker
  